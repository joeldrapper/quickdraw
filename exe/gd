#!/usr/bin/env ruby
# frozen_string_literal: true

require "async"
require "concurrent"

require_relative "../lib/green_dots"

directory = ARGV[0] || "test"

$LOAD_PATH.unshift File.expand_path("#{directory}/support")

require "helper"

run = GreenDots::Run.new

Sync do
	Dir.glob("./**/*.test.rb").reject { |f| f.start_with? "#{directory}/support/" }.shuffle.each do |f|
		Async do
			Class.new(GreenDots::Context) do
				class_eval(
					File.read(f), f, 1
				)
			end.run(run)
		end
	end
end

SUCCESS_EMOJI = %w[💃 🕺 🎉 🎊 💪 👏 🙌 ✨ 🥳 🎈]

puts "\n\n"
puts "#{run.successes} expectations passed. #{SUCCESS_EMOJI.sample}"
